---
title: "A ggplot2 Tutorial for Beautiful Plotting in R"
author: "Cédric"
date: 2019-08-05
image: img/banner/sun_RichardStrozynski.jpg
layout: post
showtoc: false
description: "This is a rework of the blog entry called 'Beautiful plotting in R: A ggplot2 cheatsheet' by Zev Ross, posted in 2014 and updated last in 2016. Most changes were made to have an updated version, to follow code style guides, to change style and aesthetics of plots to be (more) beautiful and meaningful and to include additional tipps."
tags: ["R", "ggplot2", "tidyverse", "DataViz", "tutorial"]
editor_options:
  chunk_output_type: console
---



<p><em>Last updated: 2019-08-05</em></p>
<div id="introductory-words" class="section level2">
<h2>Introductory Words</h2>
<p>Begin of 2016, I had to prepare my PhD introductory talk and I started using <code>ggplot2</code> to visualize my data since I never liked the syntax and style of base plots in <code>R</code>. Because I was short on time, I plotted these figures by try’n’error and with the help of lots of googling. The resource I came always back to was a blog entry called <a href="http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/"><strong>Beautiful plotting in R: A ggplot2 cheatsheet</strong></a> by <a href="https://twitter.com/zevross">Zev Ross</a>, posted on 4. August 2014, updated last in January 2016.</p>
<p>After giving the talk which contained some quite beautiful plots thanks to the blog post, I decided to go through this tutorial step-by-step. I learned so much from it and directly started modifying the codes and over the time I added some additional code snippets, chart types and resources.</p>
<p>Major changes I’ve made:</p>
<ul>
<li>to follow the R style guide (e.g. by <a href="http://adv-r.had.co.nz/Style.html">Hadley Wickham</a>, <a href="https://google.github.io/styleguide/Rguide.xml">Google</a> or the <a href="https://ourcodingclub.github.io/2017/04/25/etiquette.html#syntax">Coding Club</a> style guides),</li>
<li>to change style and aesthetics of plots (e.g. axis titles, legends and nice colors for all plots not only some),</li>
<li>to have a updated version which keeps track of changes in <code>ggplot2</code>,</li>
<li>to modify data import (GitHub source),</li>
<li>to have an executable R script for exercises and workshops</li>
<li>to include additional tipps on e.g:
<ul>
<li>other plot types (e.g. contour plot, rug representation, ridge plot)</li>
<li>how and why to use the viridis color palettes</li>
<li>creating minimal plots using the Tufte plotting style</li>
<li>how to adjust the plots title, subtitle and caption</li>
<li>how to add different types of lines to a plot</li>
<li>how to change the order in a legend and legend key names</li>
<li>how to add labels to your data (and how to do it in a beautiful way)</li>
</ul></li>
</ul>
<p>Since the blog entry by Zev Ross was not updated for some years, I hosted the updated version (last update Jan 2017) on my GitHub. Now it finds its proper place on this homepage! (Plus I added some updates, for example the fantastic <code>patchwork</code> package. And pie charts because everyone looooves pie charts!)</p>
</div>
<div id="toc" class="section level2">
<h2>Table of Content</h2>
<ul>
<li><a href="#prep">Preparation</a></li>
<li><a href="#data">The Dataset</a></li>
<li><a href="#ggplot">The <code>ggplot2</code> Package</a></li>
<li><a href="#default">A Default ggplot</a></li>
<li><a href="#axes">Working with Axes</a></li>
<li><a href="#titles">Working with Titles</a></li>
<li><a href="#legends">Working with Legends</a></li>
<li><a href="#style">Working with Backgrounds &amp; Grid Lines</a></li>
<li><a href="#margins">Working with Margins</a></li>
<li><a href="#panels">Working with Multi-Panel Plots</a></li>
<li><a href="#themes">Working with Themes</a></li>
<li><a href="#colors">Working with Colors</a></li>
<li><a href="#lines">Working with Lines</a></li>
<li><a href="#text">Working with Text</a></li>
<li><a href="#coords">Working with Coordinates</a></li>
<li><a href="#charts">Working with Chart Types</a></li>
<li><a href="#ribbons">Working with Ribbons (AUC, CI, etc.)</a></li>
<li><a href="#smooths">Working with Smoothings</a></li>
<li><a href="#interactive">Working with Interactive Plots</a></li>
</ul>
</div>
<div id="prep" class="section level2">
<h2>Preparation</h2>
<ul>
<li>You can download the data we are using in this post <a href="https://github.com/Z3tt/R-Tutorials/blob/master/ggplot2/chicago-nmmaps.csv">here</a>.</li>
<li>You can find the Rmarkdwon script with the code executed in this blogpost <a href="https://github.com/Z3tt/Z3tt/blob/master/content/post/2019-08-05_ggplot2-tutorial.Rmd">here</a>.</li>
<li>You need to install the following packages to execute this tutorial:
<ul>
<li>ggplot2</li>
<li>ggthemes</li>
<li>tidyverse</li>
<li>extrafont</li>
<li>patchwork</li>
<li>cowplot</li>
<li>grid</li>
<li>gridExtra</li>
<li>ggrepel</li>
<li>reshape2</li>
<li>ggridges</li>
<li>shiny</li>
</ul></li>
</ul>
<pre class="r"><code>install.packages(c(&quot;ggplot2&quot;, &quot;ggthemes&quot;, &quot;tidyverse&quot;, &quot;extrafont&quot;, &quot;cowplot&quot;, 
                   &quot;grid&quot;, &quot;gridExtra&quot;, &quot;ggrepel&quot;, &quot;reshape2&quot;, &quot;ggridges&quot;, &quot;shiny&quot;))

devtools::install_github(&quot;thomasp85/patchwork&quot;)</code></pre>
<p>(For teaching reasons and if people jump to any plot, I load the package needed beside ggplot2 in the respective chunk.)</p>
</div>
<div id="data" class="section level2">
<h2>The Dataset</h2>
<p>We are using data from the <em>National Morbidity and Mortality Air Pollution Study</em> (NMMAPS). To make the plots manageable we are limiting the data to Chicago and 1997-2000. For more detail on this dataset, consult Roger Peng’s book <a href="http://www.springer.com/de/book/9780387781662">Statistical Methods in Environmental Epidemiology with R</a>.</p>
<pre class="r"><code>chic &lt;- readr::read_csv(&quot;https://raw.githubusercontent.com/Z3tt/R-Tutorials/master/ggplot2/chicago-nmmaps.csv&quot;)
tibble::glimpse(chic)</code></pre>
<pre><code>## Observations: 1,461
## Variables: 10
## $ city     &lt;chr&gt; &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;...
## $ date     &lt;date&gt; 1997-01-01, 1997-01-02, 1997-01-03, 1997-01-04, 1997-01-05, 1997-01-06, 1997-01-07, 1997-01-08, 1997-01-09, 1997-01-10, 1997-01-11, 1997-01-12, 1997-01-13, 1997-01-14, 1997-01-15, 1997-01-16, 1997-01-17, 1997-01-18, 1997-01-19, 1997-01-20, 1997-01-21, 1997-01-22, 1997-01-23, 1997-01-24, 1997-01-25, 1997-01-26, 1997-01-27, 1997-01-28, 1997-01-29, 1997-01-30, 1997-01-31, 1997-02-01, 1997-02-02, 1997-02-03, 1997-02-04, 1997-02-05, 1997-02-06, 1997-02-07, 1997-02-08, 1997-02-09, 1997-02-10, 1997-02-11, 1997-02-12, 1997-02-13, 1997-02-14, 1997-02-15, 1997-02-16, 1997-02-17, 1997-02-18, 1997-02-19, 1997-02-20, 1997-02-21, 1997-02-22, 1997-02-23, 1997-02-24, 1997-02-25, 1997-...
## $ death    &lt;dbl&gt; 137, 123, 127, 146, 102, 127, 116, 118, 148, 121, 110, 127, 129, 151, 128, 132, 116, 142, 124, 124, 127, 121, 134, 120, 109, 109, 115, 105, 114, 120, 117, 126, 97, 96, 119, 125, 116, 118, 121, 114, 111, 107, 127, 98, 104, 122, 124, 120, 106, 103, 139, 133, 109, 121, 111, 105, 107, 123, 124, 125, 108, 114, 104, 120, 134, 101, 102, 125, 119, 115, 121, 112, 127, 99, 125, 115, 113, 105, 113, 120, 105, 119, 147, 123, 108, 117, 110, 106, 96, 119, 119, 99, 120, 130, 97, 105, 102, 104, 137, 111, 108, 96, 100, 105, 128, 120, 98, 118, 94, 117, 121, 110, 110, 108, 121, 114, 116, 109, 123, 115, 101, 118, 100, 126, 126, 121, 114, 112, 111, 111, 107, 124, 104, 107, 109, 133, 108, 109...
## $ temp     &lt;dbl&gt; 36.0, 45.0, 40.0, 51.5, 27.0, 17.0, 16.0, 19.0, 26.0, 16.0, 1.5, 1.0, 3.0, 10.0, 19.0, 9.5, -3.0, 0.0, 14.0, 31.0, 35.0, 36.5, 26.0, 32.0, 14.5, 11.0, 17.0, 2.0, 8.0, 16.5, 31.5, 35.0, 36.5, 30.0, 34.5, 30.0, 26.0, 25.5, 25.5, 26.0, 27.0, 23.5, 21.0, 20.5, 25.5, 20.0, 18.5, 30.0, 48.5, 37.5, 35.5, 36.0, 26.0, 28.0, 21.5, 25.5, 36.5, 34.5, 37.5, 45.5, 35.0, 33.5, 38.0, 33.0, 26.5, 35.5, 39.0, 37.0, 44.0, 37.0, 33.5, 37.5, 26.5, 19.0, 24.5, 45.0, 33.5, 35.5, 46.0, 53.5, 37.5, 32.5, 33.0, 40.5, 44.0, 60.5, 55.5, 43.5, 37.5, 38.5, 44.5, 53.0, 59.5, 62.5, 60.5, 45.0, 34.0, 28.5, 30.0, 30.5, 33.5, 33.5, 38.5, 41.5, 49.0, 43.0, 40.5, 40.0, 45.5, 49.0, 45.0, 43.0, 48.5, 47.5, 4...
## $ dewpoint &lt;dbl&gt; 37.50000, 47.25000, 38.00000, 45.50000, 11.25000, 5.75000, 7.00000, 17.75000, 24.00000, 5.37500, -6.62500, -8.87500, 1.50000, 11.50000, 23.25000, -9.75000, -10.37500, -4.12500, 22.62500, 27.25000, 41.62500, 20.75000, 18.75000, 29.50000, -1.37500, 17.12500, 8.37500, -6.37500, 11.00000, 16.37500, 33.75000, 29.66667, 29.62500, 28.00000, 32.00000, 24.25000, 21.87500, 23.37500, 22.50000, 21.00000, 21.75000, 19.50000, 11.60000, 16.37500, 23.00000, 15.25000, 8.12500, 32.62500, 41.37500, 27.50000, 44.12500, 29.62500, 24.25000, 14.62500, 10.87500, 27.12500, 35.00000, 30.25000, 36.00000, 44.00000, 27.37500, 29.37500, 28.87500, 28.62500, 13.37500, 35.25000, 28.25000, 32.62500, 33....
## $ pm10     &lt;dbl&gt; 13.052268, 41.948600, 27.041751, 25.072573, 15.343121, 9.364655, 20.228428, 33.134819, 12.118381, 24.761534, 18.126151, 16.013770, 34.991079, 64.945403, 26.941955, 27.022906, 18.837025, 31.859740, 30.923168, 19.894566, 27.882017, 18.508762, 11.845698, 26.687346, 16.612825, 21.641455, 22.672498, 28.101180, 51.776607, 48.741462, 24.686329, 23.784943, 27.762150, 21.600928, 17.050900, 10.157749, 15.943086, 33.010704, 14.955909, 30.410449, 23.914813, 22.972347, 12.712336, 22.719836, 35.676001, 28.373076, 15.662430, 38.744847, 27.597166, 17.612211, 29.768805, 7.340321, 7.856717, 7.908915, 17.834350, 41.124012, 34.052583, 19.749350, 26.126759, 28.129506, 9.940940, 15.980970, 2...
## $ o3       &lt;dbl&gt; 5.659256, 5.525417, 6.288548, 7.537758, 20.760798, 14.940874, 11.920985, 8.678477, 13.355892, 10.448264, 15.866094, 15.115290, 9.381068, 8.029508, 7.066111, 20.113023, 15.363898, 12.713223, 9.616133, 16.840369, 12.758676, 21.024213, 18.665072, 7.131938, 17.167861, 9.960118, 9.167350, 13.613967, 7.945009, 7.660619, 11.882608, 16.676182, 12.032368, 21.849559, 10.887549, 14.894031, 15.957824, 14.391243, 19.749645, 12.397635, 14.193562, 20.492388, 23.091993, 20.171005, 15.453240, 19.526661, 20.019234, 17.297562, 27.013275, 19.055436, 6.890252, 16.313610, 23.015853, 24.990318, 18.939318, 12.526243, 7.962753, 13.194153, 15.178614, 13.860717, 30.992349, 29.260852, 15.413875, 1...
## $ time     &lt;dbl&gt; 3654, 3655, 3656, 3657, 3658, 3659, 3660, 3661, 3662, 3663, 3664, 3665, 3666, 3667, 3668, 3669, 3670, 3671, 3672, 3673, 3674, 3675, 3676, 3677, 3678, 3679, 3680, 3681, 3682, 3683, 3684, 3685, 3686, 3687, 3688, 3689, 3690, 3691, 3692, 3693, 3694, 3695, 3696, 3697, 3698, 3699, 3700, 3701, 3702, 3703, 3704, 3705, 3706, 3707, 3708, 3709, 3710, 3711, 3712, 3713, 3714, 3715, 3716, 3717, 3718, 3719, 3720, 3721, 3722, 3723, 3724, 3725, 3726, 3727, 3728, 3729, 3730, 3731, 3732, 3733, 3734, 3735, 3736, 3737, 3738, 3739, 3740, 3741, 3742, 3743, 3744, 3745, 3746, 3747, 3748, 3749, 3750, 3751, 3752, 3753, 3754, 3755, 3756, 3757, 3758, 3759, 3760, 3761, 3762, 3763, 3764, 3765, 3766, ...
## $ season   &lt;chr&gt; &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;...
## $ year     &lt;dbl&gt; 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, ...</code></pre>
<pre class="r"><code>head(chic, 10)</code></pre>
<pre><code>## # A tibble: 10 x 10
##    city  date       death  temp dewpoint  pm10    o3  time season  year
##    &lt;chr&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1 chic  1997-01-01   137  36      37.5  13.1   5.66  3654 Winter  1997
##  2 chic  1997-01-02   123  45      47.2  41.9   5.53  3655 Winter  1997
##  3 chic  1997-01-03   127  40      38    27.0   6.29  3656 Winter  1997
##  4 chic  1997-01-04   146  51.5    45.5  25.1   7.54  3657 Winter  1997
##  5 chic  1997-01-05   102  27      11.2  15.3  20.8   3658 Winter  1997
##  6 chic  1997-01-06   127  17       5.75  9.36 14.9   3659 Winter  1997
##  7 chic  1997-01-07   116  16       7    20.2  11.9   3660 Winter  1997
##  8 chic  1997-01-08   118  19      17.8  33.1   8.68  3661 Winter  1997
##  9 chic  1997-01-09   148  26      24    12.1  13.4   3662 Winter  1997
## 10 chic  1997-01-10   121  16       5.38 24.8  10.4   3663 Winter  1997</code></pre>
</div>
<div id="ggplot" class="section level2">
<h2>The <code>ggplot2</code> Package</h2>
<blockquote>
<p><code>ggplot2</code> is a system for declaratively creating graphics, based on <a href="https://www.amazon.com/Grammar-Graphics-Statistics-Computing/dp/0387245448/ref=as_li_ss_tl?ie=UTF8&amp;qid=1477928463&amp;sr=8-1&amp;keywords=the+grammar+of+graphics&amp;linkCode=sl1&amp;tag=ggplot2-20&amp;linkId=f0130e557161b83fbe97ba0e9175c431">The Grammar of Graphics</a>. You provide the data, tell <code>ggplot2</code> how to map variables to aesthetics, what graphical primitives to use, and it takes care of the details.</p>
</blockquote>
<p>Consequently, a ggplot is built up from a few basic elements:</p>
<ol style="list-style-type: decimal">
<li><strong>Data</strong>:<br />
The raw data that you want to plot.</li>
<li><strong>Geometries</strong> <code>geom_</code>:<br />
The geometric shapes that will represent the data.</li>
<li><strong>Aesthetics</strong> <code>aes()</code>:<br />
Aesthetics of the geometric and statistical objects, such as color, size, shape, transparency and position.</li>
<li><strong>Scales</strong> <code>scale_</code>:<br />
Maps between the data and the aesthetic dimensions, such as data range to plot width or factor values to colors.</li>
<li><strong>Statistical transformations</strong> <code>stat_</code>:<br />
Statistical summaries of the data, such as quantiles, fitted curves and sums.</li>
<li><strong>Coordinate system</strong> <code>coord_</code>:<br />
The transformation used for mapping data coordinates into the plane of the data rectangle.</li>
<li><strong>Facets</strong> <code>facet_</code>:<br />
The arrangement of the data into a grid of plots.</li>
<li><strong>Visual themes</strong> <code>theme()</code>:<br />
The overall visual defaults of a plot, such as background, grids, axes, default typeface, sizes and colors.</li>
</ol>
</div>
<div id="default" class="section level2">
<h2>A Default ggplot</h2>
<p>First, we are going to load the <code>ggplot2</code>package (which we can also load via the <a href="https://www.tidyverse.org/">tidyverse package collection</a>):</p>
<pre class="r"><code>library(ggplot2)
#library(tidyverse)</code></pre>
<p><code>ggplot2</code> syntax is different from base R. As shown before, we always start to define a plotting element by calling <code>ggplot(data, aes(variable1, variable2))</code> which just tells <code>ggplot2</code> that we are going to work with that data. Thus, only a panel is created when running this because <code>ggplot2</code> does not know <em>how</em> we want to plot that data.</p>
<pre class="r"><code>(g &lt;- ggplot(chic, aes(x = date, y = temp)))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ggplot-1.png" width="100%" /></p>
<p><strong>Tipp:</strong> By using parentheses while creating an object the object will be printed immediately (instead of writing <code>g &lt;- ggplot(...)</code> and then <code>g</code>).</p>
<p>Let’s tell <code>ggplot</code> which style we want to use:</p>
<pre class="r"><code>g + geom_point()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ggplot-default-1.png" width="100%" /></p>
<p>(No worries, we are going to learn several plot types later.)</p>
<div id="change-color-of-points" class="section level3">
<h3>Change Color of Points</h3>
<p>Within this command, you already can insert aesthetics as changing the color of your points:</p>
<pre class="r"><code>g + geom_point(color = &quot;firebrick&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ggplot-default-col-1.png" width="100%" /></p>
<p>By applying that to our plotting element, the following plots based on <code>g</code> are going to have red points.</p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="axes" class="section level2">
<h2>Working with Axes</h2>
<div id="add-axis-labels" class="section level3">
<h3>Add Axis Labels</h3>
<p>Let’s add some well-written labels to the axes:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = expression(paste(&quot;Temperature (&quot;, degree ~ F, &quot;)&quot;)))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/axis-labs-1.png" width="100%" /></p>
</div>
<div id="move-labels-away-from-the-plot-change-color" class="section level3">
<h3>Move Labels Away from the Plot &amp; Change Color</h3>
<p><code>theme()</code> is an essential command to modify all kinds of theme elements (texts and titles, boxes, symbols, backgrounds, …). We will use a lot of them – to see what is possible have a look <a href="http://docs.ggplot2.org/current/theme.html">here</a>.</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(axis.title.x = element_text(color = &quot;sienna&quot;, 
                                    size = 15, vjust = -0.35),
        axis.title.y = element_text(color = &quot;orangered&quot;, 
                                    size = 15, vjust = 0.35))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/labs-color-1.png" width="100%" /></p>
</div>
<div id="change-size-angle-of-tick-text" class="section level3">
<h3>Change Size &amp; Angle of Tick Text</h3>
<p>Using <code>angle</code> and <code>vjust</code> you can adjust the position of the text (0 = left-alligned, 0.5 = centered, 1 = right-alligned):</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;) +
  theme(axis.text.x = element_text(angle = 50, size = 16, 
                                   vjust = 0.5))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/axis-text-1.png" width="100%" /></p>
</div>
<div id="remove-axis-ticks-tick-text" class="section level3">
<h3>Remove Axis Ticks &amp; Tick Text</h3>
<p>There may be rarely a reason to do so - but this is how it works:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;) +
  theme(axis.ticks.y = element_blank(), 
        axis.text.y = element_blank())</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/axis-no-labs-1.png" width="100%" /></p>
<p>If you want to get rid of a theme element, the element of the argument is always <code>element_blank()</code>.</p>
</div>
<div id="limit-axis-range" class="section level3">
<h3>Limit Axis Range</h3>
<p>Sometimes you want to zoom into your data. You can do this without subsettting your data:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;) +
  ylim(c(0, 50))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/axis-limit-1.png" width="100%" /></p>
<p>Alternatively you can use <code>g + scale_x_continuous(limits = c(0, 50))</code> or <code>g + coord_cartesian(xlim = c(0, 50))</code>. The former removes all data points outside the range and the second adjusts the visible area.</p>
</div>
<div id="force-plot-to-start-at-origin" class="section level3">
<h3>Force Plot to Start at Origin</h3>
<p>Related to that, you can force R to plot the graph starting at the origin:</p>
<pre class="r"><code>library(tidyverse)

chic %&gt;% 
  dplyr::filter(temp &gt; 25, o3 &gt; 20) %&gt;% 
  ggplot(aes(x = temp, y = o3)) + 
    geom_point() + 
    labs(x = expression(paste(&quot;Temperature higher than 25 &quot;, degree ~ F, &quot;&quot;)), 
         y = &quot;Ozone higher than 20 ppb&quot;) + 
   expand_limits(x = 0, y = 0)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/origin-1.png" width="100%" /></p>
<p>Using <code>coord_cartesian(xlim = c(0, max(chic_red$temp)), ylim = c(0, max(chic_red$o3)))</code> will lead to the same result.</p>
<p>But also force it to <strong>literally</strong> start at the origin!</p>
<pre class="r"><code>chic %&gt;% 
  dplyr::filter(temp &gt; 25, o3 &gt; 20) %&gt;% 
  ggplot(aes(x = temp, y = o3)) + 
    geom_point() + 
    labs(x = expression(paste(&quot;Temperature higher than 25 &quot;, degree ~ F, &quot;&quot;)), 
         y = &quot;Ozone higher than 20 ppb&quot;) + 
    expand_limits(x = 0, y = 0) + 
    scale_x_continuous(expand = c(0, 0)) + 
    scale_y_continuous(expand = c(0, 0)) +
    coord_cartesian(clip = &quot;off&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/origin-force-1.png" width="100%" /></p>
</div>
<div id="axes-with-same-scaling" class="section level3">
<h3>Axes with Same Scaling</h3>
<p>For demonstrating purposes, let’s plot Temperature against Temperature with some random noise:</p>
<pre class="r"><code>ggplot(chic, aes(x = temp, y = temp + rnorm(nrow(chic), sd = 20))) +
   geom_point() +
   labs(x = &quot;Temperature (°F)&quot;) +
   xlim(c(0, 100)) + ylim(c(0, 150)) +
   coord_equal()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/axes-equal-1.png" width="100%" /></p>
</div>
<div id="use-a-function-to-alter-labels" class="section level3">
<h3>Use a Function to Alter Labels</h3>
<p>Sometimes it is handy to alter your labels a little, perhaps adding units or percent signs without adding them to your data. You can use a function in this case. Here is an example:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
   geom_point(color = &quot;firebrick&quot;) +
   labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
   scale_y_continuous(label = function(x) {return(paste(x, &quot;Degrees Fahrenheit&quot;))})  </code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/labs-alt-1.png" width="100%" /></p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="titles" class="section level2">
<h2>Working with Titles</h2>
<div id="add-a-title" class="section level3">
<h3>Add a Title</h3>
<p>We can add a title via the <code>ggtitle()</code> function:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;) + 
  ggtitle(&quot;Temperatures in Chicago&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/title-1.png" width="100%" /></p>
<p>Alternatively, you can use <code>g + labs("Temperatures in Chicago")</code>. Here you can add several arguments, e.g. additionally a <code>subtitle</code> and a <code>caption</code>:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;,
       title = &quot;Temperatures in Chicago&quot;, 
       subtitle = &quot;Seasonal pattern of daily temperatures from 1997 to 2001&quot;, 
       caption = &quot;Data: NMMAPS&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/title-labs-1.png" width="100%" /></p>
</div>
<div id="make-title-bold-add-a-space-at-the-baseline" class="section level3">
<h3>Make Title Bold &amp; Add a Space at the Baseline</h3>
<p>The face argument can be used to make the font bold or italic. The margin argument uses the margin function and you provide the top, right, bottom and left margins (the default unit is points).</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;) + 
  ggtitle(&quot;Temperatures in Chicago&quot;) +
  theme(plot.title = element_text(size = 15, face = &quot;bold&quot;, 
                                  margin = margin(10, 0, 10, 0)))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/title-bold-1.png" width="100%" /></p>
<p>(A nice way to remember the order of the margin arguments is "<strong>tr</strong>ou<strong>bl</strong>e that resembles the first letter of the four sides.)</p>
</div>
<div id="adjust-position-of-titles" class="section level3">
<h3>Adjust Position of Titles</h3>
<p>Allignement is controlled by <code>hjust</code> (which stands for horizontal adjustment):</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) +  
  ggtitle(&quot;Temperatures in Chicago&quot;) +
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(plot.title = element_text(size = 15, face = 4, hjust = 1))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/title-adjust-1.png" width="100%" /></p>
<p>Of course, there it is also possible to adjust the vertical alignment, controlled by <code>vjust</code>.</p>
</div>
<div id="use-a-non-traditional-font-in-your-title" class="section level3">
<h3>Use a Non-Traditional Font in Your Title</h3>
<p>Note that you can also use different fonts. To use fonts which are installed on your machine (and you may be using in your office program) we get help from a package called <code>extrafont</code>. After we loaded the package, you need to import and load the fonts ofinstalled on your device:</p>
<pre class="r"><code>library(extrafont)
extrafont::font_import()</code></pre>
<pre><code>## Importing fonts may take a few minutes, depending on the number of fonts and the speed of the system.
## Continue? [y/n]</code></pre>
<pre class="r"><code>## extrafont::loadfonts(device = &quot;win&quot;)</code></pre>
<p>You can have a look on your imported font libary, by typing <code>fonts()</code> or <code>fonttable()</code>.</p>
<p>Now, we can use one of those font families:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(plot.title = element_text(size = 18, family = &quot;Merriweather&quot;))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/title-style-1.png" width="100%" /></p>
<p>(You can also set a non-default font for all text elements of your plots, for more details see section “Working with Themes”. I am going to use <em>Roboto Condensed</em> as new default font for the following plots.)</p>
<pre class="r"><code>theme_set(theme_gray(base_size = 12, base_family = &quot;Roboto Condensed&quot;))</code></pre>
</div>
<div id="change-spacing-in-multi-line-text" class="section level3">
<h3>Change Spacing in Multi-Line Text</h3>
<p>You can use the lineheight argument to change the spacing between lines. In this example, I have squished the lines together a bit (lineheight &lt; 1).</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Date&quot;, y = &quot;Temperature (°F)&quot;) + 
  ggtitle(&quot;Temperatures in Chicago\nfrom 1997 to 2001&quot;) + 
  theme(plot.title = element_text(size = 16, face = &quot;bold&quot;, 
                                  vjust = 1, lineheight = 0.75))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/multiline-title-1.png" width="100%" /></p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="legends" class="section level2">
<h2>Working with Legends</h2>
<p>We will color code the plot based on season. You can see that by default the legend title is what we specified in the color argument:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/plot-seasons-1.png" width="100%" /></p>
<div id="turn-off-the-legend" class="section level3">
<h3>Turn Off the Legend</h3>
<p>Always one of the first question is: “How can I get rid of the legend?”.</p>
<p>It is quite easy and always works with <code>legend.position = "none"</code>:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-none-1.png" width="100%" /></p>
<p>You can also use <code>guides(fill = F)</code> or use <code>scale_fill_discrete(guide = F)</code> depending on the specific case.</p>
</div>
<div id="turn-off-legend-titles" class="section level3">
<h3>Turn Off Legend Titles</h3>
<p>As we already learned, use <code>element_blank()</code> to draw <em>nothing</em>:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(legend.title = element_blank())</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-off-1.png" width="100%" /></p>
</div>
<div id="change-legend-position" class="section level3">
<h3>Change Legend Position</h3>
<p>If you want to place the legend not on the right, one uses <code>legend.position</code> as argument in <code>theme</code>:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-bottom-1.png" width="100%" /></p>
<p>Possible positions are “top”, “right”, “bottom”, and “left”.</p>
</div>
<div id="change-style-of-legend-titles" class="section level3">
<h3>Change Style of Legend Titles</h3>
<p>You can change the appearance of the legend title by adjusting the theme element <code>legend.title</code>:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(legend.title = element_text(color = &quot;chocolate&quot;, 
                                    size = 14, face = &quot;bold&quot;))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-style-1.png" width="100%" /></p>
</div>
<div id="change-legend-title" class="section level3">
<h3>Change Legend Title</h3>
<p>The most easiest way to change the title of the legend using the labs argument as well:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;, color = &quot;Seasons\nindicated\nby colors:&quot;) + 
  theme(legend.title = element_text(color = &quot;chocolate&quot;, 
                                    size = 14, face = &quot;bold&quot;))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-title-labs-1.png" width="100%" /></p>
<p>The legend details can be changed via <code>scale_color_discrete</code> or <code>scale_color_continuous</code> depending on the type of variable displaying.</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(legend.title = element_text(color = &quot;chocolate&quot;, 
                                    size = 14, face = &quot;bold&quot;)) +
  scale_color_discrete(name = &quot;Seasons\nindicated\nby colors:&quot;)</code></pre>
</div>
<div id="change-order-of-legend-keys" class="section level3">
<h3>Change Order of Legend Keys</h3>
<p>We can archieve this by changing the levels of <strong>season</strong>:</p>
<pre class="r"><code>chic$season &lt;- factor(chic$season, levels = c(&quot;Spring&quot;, &quot;Summer&quot;, 
                                              &quot;Autumn&quot;, &quot;Winter&quot;))

ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-order-1.png" width="100%" /></p>
</div>
<div id="change-legend-labels" class="section level3">
<h3>Change Legend Labels</h3>
<p>We are going to replace the seasons by the months which they are covering:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(legend.title = element_text(color = &quot;chocolate&quot;, 
                                    size = 14, face = 2)) +
  scale_color_discrete(&quot;Seasons:&quot;, labels = c(&quot;Mar - May&quot;, &quot;Jun - Aug&quot;, 
                                              &quot;Sep - Nov&quot;, &quot;Dec - Feb&quot;))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-labels-1.png" width="100%" /></p>
</div>
<div id="change-background-boxes-in-the-legend" class="section level3">
<h3>Change Background Boxes in the Legend</h3>
<p>To change the background color (fill) of the legend keys, we adjust the setting for the theme element <code>legend.key</code>:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(legend.key = element_rect(fill = &quot;darkgoldenrod1&quot;),
        legend.title = element_text(color = &quot;chocolate&quot;, 
                                    size = 14, face = 2)) +
  scale_color_discrete(&quot;Seasons:&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-boxes-1.png" width="100%" /></p>
<p>If you want to get rid of them entirely use <code>fill = NA</code>.</p>
</div>
<div id="change-size-of-legend-symbols" class="section level3">
<h3>Change Size of Legend Symbols</h3>
<p>Points in the legend get a little lost, especially without the boxes. To override the default try:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(legend.key = element_rect(fill = NA),
        legend.title = element_text(color = &quot;chocolate&quot;, 
                                    size = 14, face = 2)) +
  scale_color_discrete(&quot;Seasons:&quot;) +
  guides(color = guide_legend(override.aes = list(size = 6)))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-symbols-1.png" width="100%" /></p>
</div>
<div id="leave-a-layer-off-the-legend" class="section level3">
<h3>Leave a Layer Off the Legend</h3>
<p>Let’s say you have a point layer and you add a rug plot of the same data. By default, both the points and the “line” end up in the legend like this:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  geom_rug() +
  theme(legend.title = element_text(color = &quot;chocolate&quot;, 
                                    size = 14, face = 2)) +
  scale_color_discrete(&quot;Seasons:&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-layer-1-1.png" width="100%" /></p>
<p>You can use <code>show.legend = F</code> to turn off a layer in the legend:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  geom_rug(show.legend = F) +
  theme(legend.title = element_text(color = &quot;chocolate&quot;, size = 14, face = 2)) +
  scale_color_discrete(&quot;Seasons:&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-layer-2-1.png" width="100%" /></p>
</div>
<div id="manually-adding-legend-items" class="section level3">
<h3>Manually Adding Legend Items</h3>
<p><code>ggplot2</code> will not add a legend automatically unless you map aethetics (color, size etc) to a variable. There are times, though, that I want to have a legend so that it is clear what you are plotting.</p>
<p>Here is the default:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = o3)) +
  geom_line(color = &quot;gray&quot;) +
  geom_point(color = &quot;darkorange1&quot;) +
  labs(x = &quot;Year&quot;, y = &quot;Ozone&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-default-1.png" width="100%" /></p>
<p>We can force a legend by mapping a guide to a <strong>variable</strong>. We are mapping the lines and the points using <code>aes()</code> and we are mapping <strong>not</strong> to a variable in our dataset but to a single string (so that we get just one color for each).</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = o3)) +
  geom_line(aes(color = &quot;line&quot;)) +
  geom_point(aes(color = &quot;points&quot;)) +
  labs(x = &quot;Year&quot;, y = &quot;Ozone&quot;) +
  scale_color_discrete(&quot;Type:&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-force-1.png" width="100%" /></p>
<p>We are getting close but this is not what we want. We want gray and red! To change the color, we use <code>scale_color_manual()</code>. Additionally, we override the legend aesthetics using the <code>guide()</code> function.</p>
<p><strong>Voila!</strong> Now, we have a plot with frey lines and red pints as well as a single gray line and a single red point as legend symbols:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = o3)) + 
  geom_line(aes(color = &quot;line&quot;)) +  
  geom_point(aes(color = &quot;points&quot;)) +
  labs(x = &quot;Year&quot;, y = &quot;Ozone&quot;) +
  scale_color_manual(&quot;&quot;, guide = &quot;legend&quot;, 
                     values = c(&quot;points&quot; = &quot;darkorange1&quot;, 
                                &quot;line&quot; = &quot;gray&quot;)) +
  guides(color = guide_legend(override.aes = list(linetype = c(1, 0), 
                                                  shape = c(NA, 16))))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/legend-manual-1.png" width="100%" /></p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="style" class="section level2">
<h2>Working with Backgrounds &amp; Grid Lines</h2>
<p>There are ways to change the entire look of your plot with one function (see below) but if you want to simply change the colors of some elements, you can also do that.</p>
<div id="change-the-panel-color" class="section level3">
<h3>Change the Panel Color</h3>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  theme(panel.background = element_rect(fill = &quot;white&quot;))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/panel-color-1.png" width="100%" /></p>
</div>
<div id="change-grid-lines" class="section level3">
<h3>Change Grid Lines</h3>
<p>There are two types of grid lines: major grid lines indicating the ticks and minor grid lines between the major ones.</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(panel.grid.major = element_line(color = &quot;gray10&quot;, size = 0.5),
        panel.grid.minor = element_line(color = &quot;gray70&quot;, size = 0.25))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/grid-lines-1.png" width="100%" /></p>
<p>Furthermore, you can also define the breaks between both, major and minor grid lines:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  scale_y_continuous(breaks = seq(0, 100, 10),
                     minor_breaks = seq(0, 100, 2.5))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/grid-breaks-1.png" width="100%" /></p>
</div>
<div id="change-the-plot-background-color" class="section level3">
<h3>Change the Plot Background Color</h3>
<p>To change the background color (fill) of the plot area, one needs to adjust the theme element <code>plot.background</code>:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(plot.background = element_rect(fill = &quot;gray60&quot;))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/background-color-1.png" width="100%" /></p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="margins" class="section level2">
<h2>Working with Margins</h2>
<p>Sometimes it is useful to add a little space to the plot margin. Similar to the previous examples we can use an argument to the <code>theme()</code> function. In this case the argument is <code>plot.margin</code>. As In the previous example we already illustrated the default margin by changing the background color using plot.background.</p>
<p>Now let us add extra space to both the left and right. The argument, <code>plot.margin</code>, can handle a variety of different units (cm, inches, etc.) but it requires the use of the function unit from the package <code>grid</code> to specify the units. Here I am using a 5 cm margin on the right and left.</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;firebrick&quot;) +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  theme(plot.background = element_rect(fill = &quot;gray60&quot;),
        plot.margin = unit(c(1, 5, 1, 5), &quot;cm&quot;))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/margin-1.png" width="100%" /></p>
<p>The order of the margin sides is top, right, bottom, left - a nice way to remember this order is "<strong>tr</strong>ou<strong>bl</strong>e that sorts the first letter of the four sides.</p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
<div id="panels" class="section level2">
<h2>Working with Multi-Panel Plots</h2>
<p>The <code>ggplot2</code> package has two nice functions for creating multi-panel plots. They are related but a little different <code>facet_wrap</code> creates essentially a ribbon of plots based on a single variable while <code>facet_grid</code> can take two variables.</p>
<div id="create-a-single-row-of-plots-based-on-one-variable" class="section level3">
<h3>Create a Single Row of Plots Based on One Variable</h3>
<p><code>facet_wrap</code> creates a facet of a single variable, written with a tilde in front: <code>facet_wrap(~ variable)</code>. The appearance of these subplots is controlled by the arguments <code>ncol</code> and <code>nrow</code>:</p>
<pre class="r"><code>g &lt;- ggplot(chic, aes(x = date, y = temp)) +
       geom_point(color = &quot;chartreuse4&quot;) +
       labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;)

g + facet_wrap(~ year, nrow = 1) +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/wrap-plots-1-row-1.png" width="100%" /></p>
</div>
<div id="create-a-matrix-of-plots-based-on-one-variable" class="section level3">
<h3>Create a Matrix of Plots Based on One Variable</h3>
<pre class="r"><code>g + facet_wrap(~ year, nrow = 2)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/wrap-plots-2-rows-1.png" width="100%" /></p>
</div>
<div id="allow-scales-to-roam-free" class="section level3">
<h3>Allow Scales to Roam Free</h3>
<p>The default for multi-panel plots in <code>ggplot2</code> is to use equivalent scales in each panel. But sometimes you want to allow a panels own data to determine the scale. This is not often a good idea since it may give your user the wrong impression about the data but to do this you can set <code>scales = "free"</code> like this:</p>
<pre class="r"><code>g + facet_wrap(~ year, nrow = 2, scales = &quot;free&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/wrap-plots-scales-free-1.png" width="100%" /></p>
<p>Note that both, x and y axes differ in their range!</p>
</div>
<div id="create-a-grid-of-plots-based-on-two-variables" class="section level3">
<h3>Create a Grid of Plots Based on Two Variables</h3>
<p>In case of two variables, <code>facet_grid</code> does the job. Here, the order of the variables detemrines the number of rows and columns:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = &quot;orangered&quot;) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  facet_grid(year ~ season)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/grid-plots-1.png" width="100%" /></p>
<p>To change from row to column arrangement you can change <code>facet_grid(year ~ season)</code> to <code>facet_grid(season ~ year)</code>.</p>
</div>
<div id="put-two-different-plots-side-by-side" class="section level3">
<h3>Put Two (Different) Plots Side by Side</h3>
<p>There are several ways how plots can be combined. The most easiest approach in my opinion is the <a href="https://github.com/thomasp85/patchwork"><code>patchwork</code> package</a> by Thomas Lin Pedersen:</p>
<pre class="r"><code>p1 &lt;- ggplot(chic, aes(x = date, y = temp, 
                       color = factor(season))) + 
        geom_point() + 
        geom_rug() +
        labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;)

p2 &lt;- ggplot(chic, aes(x = date, y = o3)) + 
        geom_line(color = &quot;gray&quot;) + 
        geom_point(color = &quot;darkorange1&quot;) + 
        labs(x = &quot;Year&quot;, y = &quot;Ozone&quot;)

library(patchwork)
p1 + p2</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/combine-plots-patchwork-1.png" width="100%" /></p>
<p>We can change the order by “dividing” both plots (and note the allignement even though one has a legend and one doesn’t!):</p>
<pre class="r"><code>p1 / p2</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/combine-plots-patchwork-2-1.png" width="100%" /></p>
<p>And also nested plots are possible!</p>
<pre class="r"><code>(g + p2) / p1</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/combine-plots-patchwork-3-1.png" width="100%" /></p>
<p>(Note the alignment of the plots even though only one row contains a legend.)</p>
<p>Alternatively, the <a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html"><code>cowplot</code> package</a> by Claus Wilke provides the same functonality (and lots of other good utilities):</p>
<pre class="r"><code>library(cowplot)
plot_grid(p1, p2)</code></pre>
<p>… and so does the <code>gridExtra</code> package as well:</p>
<pre class="r"><code>library(gridExtra)
grid.arrange(p1, p2, ncol = 2)</code></pre>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="themes" class="section level2">
<h2>Working with Themes</h2>
<div id="change-the-overall-plotting-style" class="section level3">
<h3>Change the Overall Plotting Style</h3>
<p>You can change the entire look of the plots by using themes. As an example, Jeffrey Arnold has put together the library <code>ggthemes</code> with several custom themes. For a list you can visit the <a href="https://github.com/jrnold/ggthemes"><code>ggthemes</code> site</a>. Without any coding you can just adapt several styles, some of them well known for their style and aesthetics.</p>
<p>Here is an example copying the <a href="https://www.google.de/search?q=economist+graphic&amp;tbm=isch">plotting style</a> in the <a href="http://www.economist.com/">The Economist</a> magazine:</p>
<pre class="r"><code>library(ggthemes)

ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  ggtitle(&quot;Ups and Downs of Chicagos Daily Temperatures&quot;) +
  theme_economist() + 
  scale_color_economist(name = &quot;Seasons:&quot;) +
  theme(legend.title = element_text(size = 12, face = &quot;bold&quot;))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/Economist-1.png" width="100%" /></p>
<p>Another example is the plotting style of Tufte, a minimal ink theme based on <a href="http://www.aiga.org/medalist-edwardtufte">Edward Tufte</a>’s book <a href="https://www.edwardtufte.com/tufte/books_vdqi">The Visual Display of Quantitative Information</a>. This is the book that popularized <a href="https://www.edwardtufte.com/tufte/minard">Minard’s chart depicting Napoleon’s march on Russia</a> as one of the <strong>best statistical drawings ever created</strong>. Tuftes plots became famous due to the purism in their style. But see yourself:</p>
<pre class="r"><code>set.seed(2019)
chic.red &lt;- chic[sample(nrow(chic), 50), ]

ggplot(chic.red, aes(x = temp, y = o3)) +
  geom_point() +
  labs(x = &quot;Temperature (°F)&quot;, y = &quot;Ozone&quot;) + 
  ggtitle(&quot;Temperature and Ozone Levels in Chicago&quot;) +
  theme_tufte() +
  stat_smooth(method = &quot;lm&quot;, col = &quot;black&quot;, size = 0.7, 
              fill = &quot;gray60&quot;, alpha = 0.2)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/Tufte-1.png" width="100%" /></p>
<p>Since Tufte’s style is about minimalism, we first reduced the number of data points shown to (at least) try to follow his rules. (Do not care about that <code>stat_smooth()</code> command, I will explain it later. Just added it to make plot more interesting.)</p>
<pre class="r"><code>ggplot(chic.red, aes(x = temp, y = o3)) +
  geom_point() +
  labs(x = &quot;Temperature (°F)&quot;, y = &quot;Ozone&quot;) + 
  ggtitle(&quot;Temperature and Ozone Levels in Chicago&quot;) +
  theme_tufte() +
  stat_smooth(method = &quot;lm&quot;, col = &quot;black&quot;, size = 0.7, 
              fill = &quot;gray60&quot;, alpha = 0.2) + 
  geom_rangeframe()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/Tufte-2-1.png" width="100%" /></p>
<p>If you like the way of plotting have a look on <a href="http://motioninsocial.com/tufte/">this blog entry</a> recreating several Tufte plots in R.</p>
</div>
<div id="change-the-size-of-all-plot-text-elements" class="section level3">
<h3>Change the Size of All Plot Text Elements</h3>
<p>It is incredibly easy to change the size of all the text elements at once. If you have a closer look at the default theme (see chapter “Create and Use Your Custom Theme” below) you will notice that the sizes of all the elements are relative <code>(rel())</code> to the <code>base_size</code>. As a result, you can simply change the <code>base_size</code> if you want to increase readability of your plots:</p>
<pre class="r"><code>theme_set(theme_gray(base_size = 30, base_family = &quot;Roboto Condensed&quot;))

ggplot(chic, aes(x = date, y = temp, color = factor(season))) + 
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  guides(color = F) </code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/theme-base-size-1.png" width="100%" /></p>
</div>
<div id="create-and-use-your-custom-theme" class="section level3">
<h3>Create and Use Your Custom Theme</h3>
<p>If you want to change the theme for an entire session you can use <code>theme_set</code> as in <code>theme_set(theme_bw())</code>. The default is called <code>theme_gray</code>. If you wanted to create your own custom theme, you could extract the code directly from the gray theme and modify. Note that the <code>rel()</code> function change the sizes relative to the <code>base_size</code>.</p>
<pre class="r"><code>theme_gray</code></pre>
<pre><code>## function (base_size = 11, base_family = &quot;&quot;, base_line_size = base_size/22, 
##     base_rect_size = base_size/22) 
## {
##     half_line &lt;- base_size/2
##     theme(line = element_line(colour = &quot;black&quot;, size = base_line_size, 
##         linetype = 1, lineend = &quot;butt&quot;), rect = element_rect(fill = &quot;white&quot;, 
##         colour = &quot;black&quot;, size = base_rect_size, linetype = 1), 
##         text = element_text(family = base_family, face = &quot;plain&quot;, 
##             colour = &quot;black&quot;, size = base_size, lineheight = 0.9, 
##             hjust = 0.5, vjust = 0.5, angle = 0, margin = margin(), 
##             debug = FALSE), axis.line = element_blank(), axis.line.x = NULL, 
##         axis.line.y = NULL, axis.text = element_text(size = rel(0.8), 
##             colour = &quot;grey30&quot;), axis.text.x = element_text(margin = margin(t = 0.8 * 
##             half_line/2), vjust = 1), axis.text.x.top = element_text(margin = margin(b = 0.8 * 
##             half_line/2), vjust = 0), axis.text.y = element_text(margin = margin(r = 0.8 * 
##             half_line/2), hjust = 1), axis.text.y.right = element_text(margin = margin(l = 0.8 * 
##             half_line/2), hjust = 0), axis.ticks = element_line(colour = &quot;grey20&quot;), 
##         axis.ticks.length = unit(half_line/2, &quot;pt&quot;), axis.ticks.length.x = NULL, 
##         axis.ticks.length.x.top = NULL, axis.ticks.length.x.bottom = NULL, 
##         axis.ticks.length.y = NULL, axis.ticks.length.y.left = NULL, 
##         axis.ticks.length.y.right = NULL, axis.title.x = element_text(margin = margin(t = half_line/2), 
##             vjust = 1), axis.title.x.top = element_text(margin = margin(b = half_line/2), 
##             vjust = 0), axis.title.y = element_text(angle = 90, 
##             margin = margin(r = half_line/2), vjust = 1), axis.title.y.right = element_text(angle = -90, 
##             margin = margin(l = half_line/2), vjust = 0), legend.background = element_rect(colour = NA), 
##         legend.spacing = unit(2 * half_line, &quot;pt&quot;), legend.spacing.x = NULL, 
##         legend.spacing.y = NULL, legend.margin = margin(half_line, 
##             half_line, half_line, half_line), legend.key = element_rect(fill = &quot;grey95&quot;, 
##             colour = &quot;white&quot;), legend.key.size = unit(1.2, &quot;lines&quot;), 
##         legend.key.height = NULL, legend.key.width = NULL, legend.text = element_text(size = rel(0.8)), 
##         legend.text.align = NULL, legend.title = element_text(hjust = 0), 
##         legend.title.align = NULL, legend.position = &quot;right&quot;, 
##         legend.direction = NULL, legend.justification = &quot;center&quot;, 
##         legend.box = NULL, legend.box.margin = margin(0, 0, 0, 
##             0, &quot;cm&quot;), legend.box.background = element_blank(), 
##         legend.box.spacing = unit(2 * half_line, &quot;pt&quot;), panel.background = element_rect(fill = &quot;grey92&quot;, 
##             colour = NA), panel.border = element_blank(), panel.grid = element_line(colour = &quot;white&quot;), 
##         panel.grid.minor = element_line(size = rel(0.5)), panel.spacing = unit(half_line, 
##             &quot;pt&quot;), panel.spacing.x = NULL, panel.spacing.y = NULL, 
##         panel.ontop = FALSE, strip.background = element_rect(fill = &quot;grey85&quot;, 
##             colour = NA), strip.text = element_text(colour = &quot;grey10&quot;, 
##             size = rel(0.8), margin = margin(0.8 * half_line, 
##                 0.8 * half_line, 0.8 * half_line, 0.8 * half_line)), 
##         strip.text.x = NULL, strip.text.y = element_text(angle = -90), 
##         strip.placement = &quot;inside&quot;, strip.placement.x = NULL, 
##         strip.placement.y = NULL, strip.switch.pad.grid = unit(half_line/2, 
##             &quot;pt&quot;), strip.switch.pad.wrap = unit(half_line/2, 
##             &quot;pt&quot;), plot.background = element_rect(colour = &quot;white&quot;), 
##         plot.title = element_text(size = rel(1.2), hjust = 0, 
##             vjust = 1, margin = margin(b = half_line)), plot.subtitle = element_text(hjust = 0, 
##             vjust = 1, margin = margin(b = half_line)), plot.caption = element_text(size = rel(0.8), 
##             hjust = 1, vjust = 1, margin = margin(t = half_line)), 
##         plot.tag = element_text(size = rel(1.2), hjust = 0.5, 
##             vjust = 0.5), plot.tag.position = &quot;topleft&quot;, plot.margin = margin(half_line, 
##             half_line, half_line, half_line), complete = TRUE)
## }
## &lt;bytecode: 0x00000000066d39c8&gt;
## &lt;environment: namespace:ggplot2&gt;</code></pre>
<p>Now, let us modify the default theme function and have a look at the result:</p>
<pre class="r"><code>theme_custom &lt;- function (base_size = 12, base_family = &quot;Roboto Condensed&quot;) {
  half_line &lt;- base_size/2
  theme(line = element_line(color = &quot;black&quot;, size = 0.5, linetype = 1, lineend = &quot;butt&quot;), 
        rect = element_rect(fill = &quot;white&quot;, color = &quot;black&quot;, size = 0.5, linetype = 1), 
        text = element_text(family = base_family, face = &quot;plain&quot;, color = &quot;black&quot;, 
                            size = base_size, lineheight = 0.9, hjust = 0.5, vjust = 0.5, 
                            angle = 0, margin = margin(), debug = F), 
        axis.line = element_blank(), 
        axis.line.x = NULL, 
        axis.line.y = NULL, 
        axis.text = element_text(size = base_size * 1.1, color = &quot;gray30&quot;), 
        axis.text.x = element_text(margin = margin(t = 0.8 * half_line/2), vjust = 1), 
        axis.text.x.top = element_text(margin = margin(b = 0.8 * half_line/2), vjust = 0), 
        axis.text.y = element_text(margin = margin(r = 0.8 * half_line/2), hjust = 1), 
        axis.text.y.right = element_text(margin = margin(l = 0.8 * half_line/2), hjust = 0), 
        axis.ticks = element_line(color = &quot;gray30&quot;, size = 0.7), 
        axis.ticks.length = unit(half_line / 1.5, &quot;pt&quot;), 
        axis.title.x = element_text(margin = margin(t = half_line), vjust = 1, 
                                    size = base_size * 1.3, face = &quot;bold&quot;), 
        axis.title.x.top = element_text(margin = margin(b = half_line), vjust = 0), 
        axis.title.y = element_text(angle = 90, margin = margin(r = half_line), 
                                    vjust = 1, size = base_size * 1.3, face = &quot;bold&quot;), 
        axis.title.y.right = element_text(angle = -90, vjust = 0, 
                                          margin = margin(l = half_line)), 
        legend.background = element_rect(color = NA), 
        legend.spacing = unit(0.4, &quot;cm&quot;), 
        legend.spacing.x = NULL, 
        legend.spacing.y = NULL, 
        legend.margin = margin(0.2, 0.2, 0.2, 0.2, &quot;cm&quot;), 
        legend.key = element_rect(fill = &quot;gray95&quot;, color = &quot;white&quot;), 
        legend.key.size = unit(1.2, &quot;lines&quot;), 
        legend.key.height = NULL, 
        legend.key.width = NULL, 
        legend.text = element_text(size = rel(0.8)), 
        legend.text.align = NULL, 
        legend.title = element_text(hjust = 0), 
        legend.title.align = NULL, 
        legend.position = &quot;right&quot;, 
        legend.direction = NULL, 
        legend.justification = &quot;center&quot;, 
        legend.box = NULL, 
        legend.box.margin = margin(0, 0, 0, 0, &quot;cm&quot;), 
        legend.box.background = element_blank(), 
        legend.box.spacing = unit(0.4, &quot;cm&quot;), 
        panel.background = element_rect(fill = &quot;white&quot;, color = NA),
        panel.border = element_rect(color = &quot;gray30&quot;, 
                                    fill = NA, size = 0.7),
        panel.grid.major = element_line(color = &quot;gray90&quot;, size = 1),
        panel.grid.minor = element_line(color = &quot;gray90&quot;, size = 0.5, 
                                        linetype = &quot;dashed&quot;),
        panel.spacing = unit(base_size, &quot;pt&quot;), 
        panel.spacing.x = NULL, 
        panel.spacing.y = NULL, 
        panel.ontop = F, 
        strip.background = element_rect(fill = &quot;white&quot;, color = &quot;gray30&quot;), 
        strip.text = element_text(color = &quot;black&quot;, size = base_size), 
        strip.text.x = element_text(margin = margin(t = half_line, 
                                                    b = half_line)), 
        strip.text.y = element_text(angle = -90, margin = margin(l = half_line, 
                                                                 r = half_line)), 
        strip.placement = &quot;inside&quot;, 
        strip.placement.x = NULL, 
        strip.placement.y = NULL, 
        strip.switch.pad.grid = unit(0.1, &quot;cm&quot;), 
        strip.switch.pad.wrap = unit(0.1, &quot;cm&quot;), 
        plot.background = element_rect(color = NA), 
        plot.title = element_text(size = base_size * 1.8, hjust = 0.5, 
                                  vjust = 1, face = &quot;bold&quot;, 
                                  margin = margin(b = half_line * 1.2)), 
        plot.subtitle = element_text(size = base_size * 1.3, hjust = 0.5, vjust = 1, 
                                     margin = margin(b = half_line * 0.9)), 
        plot.caption = element_text(size = rel(0.9), hjust = 1, vjust = 1, 
                                    margin = margin(t = half_line * 0.9)),
        plot.tag = element_text(size = rel(1.2), hjust = 0.5, vjust = 0.5), 
        plot.tag.position = &quot;topleft&quot;, 
        plot.margin = margin(base_size, base_size, base_size, base_size), complete = T)
}</code></pre>
<p>Have a look on the modified aesthetics with its new look of panel and gridlines as well as axes ticks, texts and titles:</p>
<pre class="r"><code>theme_set(theme_custom())

ggplot(chic, aes(x = date, y = temp, color = factor(season))) + 
  geom_point() + labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + guides(color = F)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/theme-set-1.png" width="100%" /></p>
<p><strong>This way of changing the plot design is highly recommended!</strong> It allows you to quickly change any element of your plots by changing it once. You can within a few seconds plot all your results in a congruent style and adapt it to other needs (e.g. a presentation with bigger font size or journall requirements)</p>
<p>You can also set quick changes using <code>theme_update()</code>:</p>
<pre class="r"><code>theme_custom &lt;- theme_update(panel.background = element_rect(fill = &quot;gray60&quot;))

ggplot(chic, aes(x = date, y = temp, color = factor(season))) + 
  geom_point() + labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + guides(color = F)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/theme-update-1.png" width="100%" /></p>
<p>For further exercises, we are going to use our own theme with a white filling and without the smaller grid lines:</p>
<pre class="r"><code>theme_custom &lt;- theme_update(panel.background = element_rect(fill = &quot;white&quot;),
                             panel.grid.major = element_line(size = 0.5),
                             panel.grid.minor = element_blank())</code></pre>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="colors" class="section level2">
<h2>Working with Colors</h2>
<p>For simple applications working with colors is straightforward in <code>ggplot2</code> but when you have more advanced needs it can be a challenge. For a more advanced treatment of the topic you should probably get your hands on <a href="http://www.springer.com/de/book/9780387981413#otherversion=9780387981406">Hadley’s book</a> which has nice coverage. There are a few other good sources including the <a href="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/">R Cookbook</a> and the <a href="http://docs.ggplot2.org/current/"><code>ggplot2</code> online docs</a>. Tian Zheng at Columbia has created a useful <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">PDF of R colors</a>.</p>
<p>In order to use color with your data, most importantly you need to know if you are dealing with a categorical or continuous variable.</p>
<div id="categorical-variables-manually-select-colors" class="section level3">
<h3>Categorical Variables: Manually Select Colors</h3>
<pre class="r"><code>(g &lt;- ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
        geom_point() + 
        labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
        theme(legend.title = element_blank()) +
        scale_color_manual(values = c(&quot;dodgerblue4&quot;, &quot;darkolivegreen4&quot;, 
                                      &quot;darkorchid3&quot;, &quot;goldenrod1&quot;)))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/color-manual-1.png" width="100%" /></p>
</div>
<div id="categorical-variables-use-built-in-palettes" class="section level3">
<h3>Categorical Variables: Use Built-In Palettes</h3>
<p>One can use the <a href="http://colorbrewer2.org/">ColorBrewer palettes</a> by calling <code>scale_*_brewer</code> that are built-in functions in the <code>ggplot2</code> package:</p>
<pre class="r"><code>g + scale_color_brewer(palette = &quot;Set1&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/color-brewer-1.png" width="100%" /></p>
<p>You can ignore the message in the console, replacing the existing scale is what we want.</p>
</div>
<div id="categorical-variables-use-tableau-colors" class="section level3">
<h3>Categorical Variables: Use <a href="http://www.tableau.com/de-de/about/blog/2016/7/colors-upgrade-tableau-10-56782">Tableau colors</a></h3>
<p>Tableau is a famous visualiztion software with a well-known color palette. For R user it is available via the <code>ggthemes</code> command <code>scale_color_tableau()</code>:</p>
<pre class="r"><code>library(ggthemes)
g + scale_color_tableau()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/color-tableau-1.png" width="100%" /></p>
</div>
<div id="continuous-variables-default-color-schemes" class="section level3">
<h3>Continuous Variables: Default Color Schemes</h3>
<p>In our example we will change the variable we want to color to ozone, a continuous variable that is strongly related to temperature (higher temperature = higher ozone). The function <code>scale_color_gradient()</code> is a sequential gradient while <code>scale_color_gradient2()</code> is diverging.</p>
<p>Here is the default <code>ggplot2</code> continuous color scheme (sequential color scheme):</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = o3)) + 
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  scale_color_continuous(&quot;Ozone:&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/colors-seq-1.png" width="100%" /></p>
<p>This code produces the same plot:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = o3)) +  
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  scale_color_gradient()</code></pre>
<p>And here is the diverging default color scheme:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = o3)) +  
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  scale_color_gradient2()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/colors-seq-alt-2-1.png" width="100%" /></p>
</div>
<div id="continuous-variables-manually-set-a-sequential-color-scheme" class="section level3">
<h3>Continuous Variables: Manually Set a Sequential Color Scheme</h3>
<p>Gradually changing color palettes that are used for continuous variables can be manually set via <code>scale_*_gradient</code>:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = o3)) + 
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  scale_color_gradient(low = &quot;darkkhaki&quot;, high = &quot;darkgreen&quot;, &quot;Ozone:&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/scale-color-gradient-1.png" width="100%" /></p>
<p>Temperature data is normally distributed so how about a diverging color scheme (rather than sequential). For diverging color you can use the <code>scale_color_gradient2</code> function:</p>
<pre class="r"><code>mid &lt;- max(chic$o3) / 2  # or mid &lt;- mean(chic$o3)

ggplot(chic, aes(x = date, y = temp, color = o3)) + 
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  scale_color_gradient2(midpoint = mid, low = &quot;blue4&quot;, 
                        mid = &quot;white&quot;, high = &quot;red4&quot;, &quot;Ozone:&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/scale-color-gradient2-1.png" width="100%" /></p>
</div>
<div id="continuous-variables-the-beautiful-viridis-color-palette" class="section level3">
<h3>Continuous Variables: The Beautiful Viridis Color Palette</h3>
<p>The <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html"><strong>viridis</strong> color palettes</a> do not only make your plots look pretty and good to perceive but also easier to read by those with colorblindness and print well in gray scale.
You can test how your plots might appear under various form of colorblindness using <a href="https://cran.r-project.org/web/packages/dichromat/index.html"><code>dichromate</code></a>) package.</p>
<p>The following multi-panel plot illustrates two out of the four viridis palettes:</p>
<pre class="r"><code>g &lt;- ggplot(chic, aes(x = date, y = temp, color = o3)) + 
       geom_point() + 
       labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;)

library(viridis)
p1 &lt;- g + scale_color_viridis(&quot;Ozone:&quot;) + ggtitle(&quot;&#39;viridis&#39; (default)&quot;)
p2 &lt;- g + scale_color_viridis(option = &quot;inferno&quot;, &quot;Ozone:&quot;) + ggtitle(&quot;&#39;inferno&#39;&quot;)
p3 &lt;- g + scale_color_viridis(option = &quot;cividis&quot;, &quot;Ozone:&quot;) + ggtitle(&quot;&#39;cividis&#39;&quot;)

library(patchwork)
(p1 + p2 + p3) * theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/viridis-continuous-1.png" width="100%" /></p>
<p>It is also possible to use the viridis color palettes for discrete variables:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  theme(legend.title = element_blank()) +
  scale_color_viridis(discrete = T, end = 1)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/viridis-discrete-1.png" width="100%" /></p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="lines" class="section level2">
<h2>Working with Lines</h2>
<div id="add-horizonal-or-vertical-lines-to-a-plot" class="section level3">
<h3>Add Horizonal or Vertical Lines to a Plot</h3>
<p>You might want to highlight a given range or threshold, which can be done plotting a line at these defined coordinates using <code>geom_hline()</code> (for “horizontal lines”) or <code>geom_vline()</code> (for “vertical lines”):</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = o3)) + 
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  geom_hline(yintercept = c(0, 73))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/hline-1.png" width="100%" /></p>
<pre class="r"><code>ggplot(chic, aes(x = temp, y = o3)) +
  geom_point(alpha = 0.5) +
  labs(x = &quot;Temperature (°F)&quot;, y = &quot;Ozone&quot;) + 
  geom_vline(aes(xintercept = median(temp)), size = 1.2, 
             color = &quot;firebrick&quot;, linetype = &quot;dashed&quot;) + 
  geom_hline(aes(yintercept = median(o3)), size = 1.2, 
             color = &quot;firebrick&quot;, linetype = &quot;dashed&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/vline-1.png" width="100%" /></p>
<p>If you want to add a line with a slope not being 0 or 1, respectively, you need to use <code>geom_abline()</code>. This is for example the case if you add a regresssion line:</p>
<pre class="r"><code>reg &lt;- lm(o3 ~ temp, data = chic)
ggplot(chic, aes(x = temp, y = o3)) +
  geom_point(alpha = 0.5) +
  labs(caption = paste0(&quot;y = &quot;, round(coefficients(reg)[2], 2), 
                        &quot; * x + &quot;, round(coefficients(reg)[1], 2)), 
       x = &quot;Temperature (°F)&quot;, y = &quot;Ozone&quot;) + 
  geom_abline(intercept = coefficients(reg)[1], slope = coefficients(reg)[2], 
              color = &quot;darkorange1&quot;, size = 1.5)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/abline-1.png" width="100%" /></p>
<p>Later, we will learn how to add a linear fit with one command using <code>stat_smooth(method = "lm")</code>. However, there might be other reasons to add a line with a given slope.</p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="text" class="section level2">
<h2>Working with Text</h2>
<div id="add-labels-to-your-data" class="section level3">
<h3>Add Labels to Your Data</h3>
<p>Sometimes, we want to label our data points. To avoid overlaying and -crowding by text labels, we use a 1% sample of the original data, equally representing the four seasons.</p>
<pre class="r"><code>set.seed(1)

library(tidyverse)
sample &lt;- chic %&gt;% 
  dplyr::group_by(season) %&gt;% 
  dplyr::sample_frac(0.01)

## code without pipes: 
## sample &lt;- sample_frac(group_by(chic, season), 0.01)

chic %&gt;% 
  group_by(season) %&gt;% 
  sample_frac(0.01) %&gt;% 
  ggplot(aes(x = date, y = temp, label = season)) +
    geom_point() + 
    geom_text(aes(color = factor(temp)), hjust = 0.5, vjust = -0.5) +
    labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
    xlim(as.Date(c(&#39;1997-01-01&#39;, &#39;2000-12-31&#39;))) + 
    ylim(c(0, 90)) +
    theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/data-text-1.png" width="100%" /></p>
<p>Okay, avoiding overlays of labels did not work out. But don’t worry, we are going to fix it in a minute!</p>
<p>You can also use <code>geom_label</code> for boxes:</p>
<pre class="r"><code>ggplot(sample, aes(x = date, y = temp, label = season)) +
  geom_point() + 
  geom_label(aes(fill = factor(temp)), color = &quot;white&quot;, 
             fontface = &quot;bold&quot;, hjust = 0.5, vjust = -0.25) +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  xlim(as.Date(c(&#39;1997-01-01&#39;, &#39;2000-12-31&#39;))) +
  ylim(c(0, 90)) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/data-label-1.png" width="100%" /></p>
<p>A cool thing is the <code>ggrepel</code> package which provides geoms for <code>ggplot2</code> to repel overlapping text as in our examples above. Here, we also show both, the original data and our sample data which gets labeled:</p>
<pre class="r"><code>library(ggrepel)
ggplot(chic, aes(x = date, y = temp, label = season)) +
  geom_point(alpha = 0.5) +
  geom_point(data = sample, aes(color = factor(temp)), size = 2.5) +
  geom_label_repel(data = sample, aes(fill = factor(temp)), 
                   color = &quot;white&quot;, fontface = &quot;bold&quot;) +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ggrepel-1.png" width="100%" /></p>
<p>This also works for the pure text labels by using <code>geom_text_repel</code>. Have a look at all the <a href="https://cran.r-project.org/web/packages/ggrepel/vignettes/ggrepel.html">usage examples</a>.</p>
</div>
<div id="add-text-annotation-in-the-top-right-top-left-etc." class="section level3">
<h3>Add Text Annotation in the Top-Right, Top-Left etc.</h3>
<p>With <code>ggplot2</code> you can set annotation coordinates to <code>Inf</code> but this is only moderately useful. Here is an example (based on code from <a href="https://groups.google.com/forum/#!topic/ggplot2/X7pD7LNdY2Y">this Google group</a>) using the library <code>grid</code> that allows you to specify the location based on scaled coordinates where 0 is low and 1 is high.</p>
<p>The <code>grobTree</code> function from the <code>grid</code> package creates a grid graphical object and textGrob creates the text graphical object. The <code>annotation_custom()</code> function comes from <code>ggplot2</code> and is designed to use a grob as input.</p>
<pre class="r"><code>library(grid)
my_grob &lt;- grobTree(textGrob(&quot;This text stays in place!&quot;, 
                             x = 0.1, y = 0.9, hjust = 0, 
                             gp = gpar(col = &quot;black&quot;, 
                                       fontsize = 15, 
                                       fontface = &quot;bold&quot;)))

ggplot(chic, aes(x = temp, y = o3)) +
  geom_point(color = &quot;firebrick&quot;, alpha = 0.5) + 
  labs(x = &quot;Temperature (°F)&quot;, y =&quot;Ozone&quot;) +
  annotation_custom(my_grob)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/grobTree-1.png" width="100%" /></p>
<p>The value of this is particularly evident when you have multiple plots with <strong>different scales</strong>. In the plot below you see that the axis scales vary yet the same code as above can be used to put the annotation is the same place on each facet.</p>
<pre class="r"><code>ggplot(chic, aes(x = temp, y = o3)) +
  geom_point(color = &quot;firebrick&quot;) + 
  labs(x = &quot;Temperature (°F)&quot;, y =&quot;Ozone&quot;) +
  facet_wrap(~ season, scales = &quot;free&quot;) +
  annotation_custom(my_grob)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/grobTree-scales-free-1.png" width="100%" /></p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="coords" class="section level2">
<h2>Working with Coordinates</h2>
<div id="flip-a-plot" class="section level3">
<h3>Flip a Plot</h3>
<p>It is incredibly easy to flip a plot on its side. Here I have added the <code>coord_flip()</code> which is all you need to flip the plot (by the way, we are trying a new plot type by using <code>geom_boxpot()</code>).</p>
<pre class="r"><code>ggplot(chic, aes(x = season, y = o3)) +
  geom_boxplot(fill = &quot;indianred&quot;) + 
  labs(x = &quot;Season&quot;, y = &quot;Ozone&quot;) +
  coord_flip()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/flip-coords-1.png" width="100%" /></p>
</div>
<div id="reverse-an-axis" class="section level3">
<h3>Reverse an Axis</h3>
<p>You can also easily reverse an axis using <code>scale_x_reverse()</code> or <code>scale_y_reverse()</code>, respectively:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = o3)) + 
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  scale_y_reverse()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/reversed-axis-1.png" width="100%" /></p>
</div>
<div id="transform-an-axis" class="section level3">
<h3>Transform an Axis</h3>
<p>… or transform the default linear mapping by using <code>scale_y_log10()</code> or <code>scale_y_sqrt()</code>. As an example, here is a log<sub>10</sub>-transformed axis (which introduces NA’s in this case so be careful):</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = o3)) + 
  geom_point() + 
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) + 
  scale_y_log10(lim = c(0.1, 100))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/log-axis-1.png" width="100%" /></p>
</div>
<div id="circularize-a-plot" class="section level3">
<h3>Circularize a Plot</h3>
<p>It is also possible to circularize (polarizee?) the coordinate system by calling `coord_polar.</p>
<pre class="r"><code>library(tidyverse)

chic %&gt;% 
  dplyr::group_by(season) %&gt;% 
  dplyr::summarize(o3 = median(o3)) %&gt;% 
  ggplot(aes(x = season, y = o3)) +
    geom_col(aes(fill = factor(season))) + 
    labs(x = &quot;&quot;, y = &quot;Median Ozone Level&quot;) +
    coord_polar() +
    guides(fill = F)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/polar-coords-1.png" width="100%" /></p>
<p>This coordinate system allows to draw pie charts as well:</p>
<pre class="r"><code>chic %&gt;% 
  dplyr::mutate(o3_avg = median(o3)) %&gt;% 
  dplyr::filter(o3 &gt; o3_avg) %&gt;% 
  dplyr::mutate(n_all = n()) %&gt;% 
  dplyr::group_by(season) %&gt;% 
  dplyr::summarize(rel = n() / unique(n_all)) %&gt;% 
  ggplot(aes(x = &quot;&quot;, y = rel)) +
    geom_col(aes(fill = factor(season)), width = 1) + 
    labs(x = &quot;&quot;, y = &quot;Proportion of Days Exceeding\nthe Median Ozone Level&quot;) +
    coord_polar(&quot;y&quot;) +
    theme(axis.ticks = element_blank())</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/pie-chart-1.png" width="100%" /></p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="charts" class="section level2">
<h2>Working with Chart Types</h2>
<div id="alternatives-to-a-box-plot" class="section level3">
<h3>Alternatives to a Box Plot</h3>
<p>Box plots are great, but they can be so incredibly boring. There are alternatives, but first we are plotting a common box plot:</p>
<pre class="r"><code>g &lt;- ggplot(chic, aes(x = season, y = o3)) + 
       labs(x = &quot;Season&quot;, y = &quot;Ozone&quot;)

g + geom_boxplot(fill = &quot;indianred&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/boxplot-1.png" width="100%" /></p>
<p>Effective? Yes.<br />
Interesting? No.</p>
<div id="alternative-plot-of-points" class="section level4">
<h4>1. Alternative: Plot of Points</h4>
<p>Let’s plot just each data point of the raw data:</p>
<pre class="r"><code>g + geom_point(color = &quot;firebrick&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/point-1.png" width="100%" /></p>
<p>Not only boring but uninformative. To improve the plot, one could add transparency to deal with overplotting:</p>
<pre class="r"><code>g + geom_point(color = &quot;firebrick&quot;, alpha = 0.1)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/point-alpha-1.png" width="100%" /></p>
<p>However, setting transparency is difficult here since either the overlap is still to high or the extreme values are not visible. Bad, so let’s try something else.</p>
</div>
<div id="alternative-jitter-the-points" class="section level4">
<h4>2. Alternative: Jitter the Points</h4>
<p>Try adding a little jitter to the data. I like this for in-house visualization but be careful using jittering because you are purposely adding noise to your data and this can result in misinterpretation of your data.</p>
<pre class="r"><code>g + geom_jitter(aes(color = season), alpha = 0.25, 
                position = position_jitter(width = 0.3)) +
    theme(legend.title = element_blank())</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/jitter-1.png" width="100%" /></p>
</div>
<div id="alternative-violin-plots" class="section level4">
<h4>3. Alternative: Violin Plots</h4>
<p>Violin plots, similar to box plots except you are using a kernel density to show where you have the most data, are a useful visualization.</p>
<pre class="r"><code>g + geom_violin(color = &quot;sienna&quot;, fill = &quot;red&quot;, alpha = 0.4)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/violin-1.png" width="100%" /></p>
</div>
<div id="alternative-combining-violin-plots-with-jitter" class="section level4">
<h4>4. Alternative: Combining Violin Plots with Jitter</h4>
<p>We can of course combine both, estimated densities and the raw data points:</p>
<pre class="r"><code>g + geom_violin(aes(color = season), fill = &quot;gray80&quot;, alpha = 0.5) +
    geom_jitter(aes(color = season), alpha = 0.25, 
                position = position_jitter(width = 0.3)) +
    theme(legend.title = element_blank()) +
    coord_flip()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/violin-jitter-1.png" width="100%" /></p>
</div>
<div id="alternative-combining-violin-plots-with-jitter-and-box-plots" class="section level4">
<h4>5. Alternative: Combining Violin Plots with Jitter and Box Plots</h4>
<p>To allow for easy estimation of quantiles, we can also add the box of the boxplot inside the violins to indicate 25%-quartile, median and 75%-quartile:</p>
<pre class="r"><code>g + geom_violin(aes(color = season), fill = &quot;gray80&quot;, alpha = 0.5) +
    geom_boxplot(outlier.alpha = 0, coef = 0, 
                 color = &quot;gray40&quot;, width = 0.1) +
    geom_jitter(aes(color = season), alpha = 0.25, 
                position = position_jitter(width = 0.3), alpha = 0.3) +
    theme(legend.title = element_blank()) +
    coord_flip()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/violin-jitter-box-1.png" width="100%" /></p>
</div>
</div>
<div id="create-a-rug-representation-to-a-plot" class="section level3">
<h3>Create a Rug Representation to a Plot</h3>
<p>A rug represents the data of a single quantitative variable, displayed as marks along an axis. In most cases, it is used in addition to scatterplots or heatmaps to visualize the overall distribution of one or both of the variables:</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  geom_rug() +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/rug-1.png" width="100%" /></p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp, color = factor(season))) +
  geom_point() +
  geom_rug(sides = &quot;r&quot;, alpha = 0.3) +
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/rug-2-1.png" width="100%" /></p>
</div>
<div id="create-a-tiled-correlation-plot" class="section level3">
<h3>Create a Tiled Correlation Plot</h3>
<p>First step is to create the correlation matrix. We are using Pearson because all the variables are fairly normally distributed (but you may consider Spearman if your variables follow a different pattern). Note that since a correlation matrix has redundant information we are setting half of it to <code>NA</code>.</p>
<pre class="r"><code>corm &lt;- round(cor(chic[ , sort(c(&quot;death&quot;, &quot;temp&quot;, &quot;dewpoint&quot;, &quot;pm10&quot;, &quot;o3&quot;))], 
                  method = &quot;pearson&quot;, use = &quot;pairwise.complete.obs&quot;), 2)
corm[lower.tri(corm)] &lt;- NA
corm</code></pre>
<pre><code>##          death dewpoint    o3 pm10  temp
## death        1    -0.47 -0.24 0.00 -0.49
## dewpoint    NA     1.00  0.45 0.33  0.96
## o3          NA       NA  1.00 0.21  0.53
## pm10        NA       NA    NA 1.00  0.37
## temp        NA       NA    NA   NA  1.00</code></pre>
<p>Now we put the resulting matrix in <strong>long</strong> format using the melt function from the <code>reshape2</code> package and drop the records with <code>NA</code> values:</p>
<pre class="r"><code>library(reshape2)
corm &lt;- melt(corm)
corm$Var1 &lt;- as.character(corm$Var1)
corm$Var2 &lt;- as.character(corm$Var2)
corm &lt;- na.omit(corm)
head(corm, 10)</code></pre>
<pre><code>##        Var1     Var2 value
## 1     death    death  1.00
## 6     death dewpoint -0.47
## 7  dewpoint dewpoint  1.00
## 11    death       o3 -0.24
## 12 dewpoint       o3  0.45
## 13       o3       o3  1.00
## 16    death     pm10  0.00
## 17 dewpoint     pm10  0.33
## 18       o3     pm10  0.21
## 19     pm10     pm10  1.00</code></pre>
<p>For the plot we will use <code>geom_tile</code> but if you have a lot of data you might consider <code>geom_raster</code> which can be much faster.</p>
<pre class="r"><code>ggplot(corm, aes(x = Var2, y = Var1)) +
   geom_tile(data = corm, aes(fill = value), color = &quot;white&quot;) +
   labs(x = &quot;Variable 2&quot;, y = &quot;Variable 1&quot;) +
   scale_fill_gradient2(low = &quot;blue&quot;, high = &quot;red&quot;, mid = &quot;white&quot;, 
                        midpoint = 0, limit = c(-1, 1), 
                        name = &quot;Correlation\n(Pearson)&quot;) +
   theme(axis.text.x = element_text(angle = 45, size = 11, 
                                    vjust = 1, hjust = 1)) +
   coord_equal()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/tile-corr-plot-1.png" width="100%" /></p>
</div>
<div id="create-a-contour-plot" class="section level3">
<h3>Create a Contour Plot</h3>
<p>Contour plots are s nice way to display three-dimensional data by indicating die thresholds of values. Here, we are going to plot the dew point (i.e. <a href="https://en.wikipedia.org/wiki/Dew_point">the temperature at which airborne water vapor will condense to form liquid dew</a>) related to temperature and ozone levels:</p>
<pre class="r"><code>## interpolate data
library(akima)
fld &lt;- with(chic, interp(x = temp, y = o3, z = dewpoint))

## prepare data in long format
library(reshape2)
df &lt;- melt(fld$z, na.rm = T)
names(df) &lt;- c(&quot;x&quot;, &quot;y&quot;, &quot;Dewpoint&quot;)
df$Temperature &lt;- fld$x[df$x]
df$Ozone &lt;- fld$y[df$y]

g &lt;- ggplot(data = df, aes(x = Temperature, y = Ozone, z = Dewpoint)) +
         theme(panel.background = element_rect(fill = &quot;white&quot;),
               panel.border = element_rect(color = &quot;black&quot;, fill = NA),
               legend.title = element_text(size = 15),
               axis.text = element_text(size = 12),
               axis.title.x = element_text(size = 15, vjust = -0.5),
               axis.title.y = element_text(size = 15, vjust = 0.2),
               legend.text = element_text(size = 12))
         
g + stat_contour(aes(color = ..level.., fill = Dewpoint))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/contour-1.png" width="100%" /></p>
<p>Surprise! As it is defined, the drew point is in most cases equal to the measured temperature.</p>
<p>The lines are indicating different levels of drew points, but this is not a pretty plot and also hard to read due to missing borders. Let’s try a tile plot using the <code>viridis</code> color palette to encode the dewpoint of each combination of ozone level and temperature:</p>
<pre class="r"><code>g + geom_tile(aes(fill = Dewpoint)) +
    scale_fill_viridis(option = &quot;inferno&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/contour-tile-1.png" width="100%" /></p>
<p>How does it look if we combine a contour plot and a tile plot to fill the area under the contour lines?</p>
<pre class="r"><code>g + geom_tile(aes(fill = Dewpoint)) + 
    stat_contour(color = &quot;white&quot;, size = 0.7, bins = 5) + 
    scale_fill_viridis()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/contour-and-tile-1.png" width="100%" /></p>
</div>
<div id="create-a-joyplot-aka-ridge-plot" class="section level3">
<h3>Create a Joyplot aka Ridge Plot</h3>
<p>Joyplots (also called <em>ridgle(line) plots</em>) are a new type of plots which is very popular at the moment. (Fun fact: The name refers to the <a href="https://en.wikipedia.org/wiki/File:Unknown_Pleasures_Joy_Division_LP_sleeve.jpg">cover of Joy Division’s “Unknown Pleasures” LP</a>.)</p>
<p>While you can create those plots with <a href="https://github.com/halhen/viz-pub/blob/master/sports-time-of-day/2_gen_chart.R">basic <code>ggplot</code> commands</a> the popularity lead to a package that make it easier create those plots: <a href="https://cran.r-project.org/web/packages/ggridges/index.html"><code>ggridges</code></a>. We are going to use this package here.</p>
<pre class="r"><code>library(ggridges)
ggplot(chic, aes(x = temp, y = factor(year))) + 
   geom_density_ridges(fill = &quot;gray90&quot;) +
   labs(x = &quot;Temperature (°F)&quot;, y = &quot;Year&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ridges-1.png" width="100%" /></p>
<p>You can easily specify the overlap and the trailing tails by using the arguments <code>rel_min_height</code> and <code>scale</code>, respectively. The package also comes with it’s own theme (but I would prefer to build my own, see chapter “Create and Use Your Custom Theme”). Additionally, we change the colors based on year to make it more appealing.</p>
<pre class="r"><code>ggplot(chic, aes(x = temp, y = factor(year), fill = year)) + 
  geom_density_ridges(alpha = 0.8, color = &quot;white&quot;, 
                      scale = 2.5, rel_min_height = 0.01) + 
  labs(x = &quot;Temperature (°F)&quot;, y = &quot;Year&quot;) + 
  guides(fill = F) + 
  theme_ridges()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ridges-spec-1.png" width="100%" /></p>
<p>You can also get rid of the overlap using values below 1 for the scaling argument (but this somehow contradicts the idea of joyplots…). Here is an example additionally using the <code>viridis</code> color gradient:</p>
<pre class="r"><code>ggplot(chic, aes(x = temp, y = season, fill = ..x..)) + 
  geom_density_ridges_gradient(scale = 0.9, gradient_lwd = 0.5, 
                               color = &quot;black&quot;) + 
  scale_fill_viridis(option = &quot;plasma&quot;, name = &quot;&quot;) + 
  labs(x = &quot;Temperature (°F)&quot;, y = &quot;Season&quot;) +
  theme_ridges(grid = F)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ridges-viridis-1.png" width="100%" /></p>
<p>We can also compare several groups per ridgeline and coloring them according to their group. This follows the idea of <a href="https://twitter.com/marcbeldata/status/888697140268204032">Marc Belzunces</a>.</p>
<pre class="r"><code>library(tidyverse)

## only plot extreme season using dplyr from the tidyverse
ggplot(data = filter(chic, season %in% c(&quot;Summer&quot;, &quot;Winter&quot;)), 
         aes(x = temp, y = year, fill = paste(year, season))) +
  geom_density_ridges(alpha = 0.7, rel_min_height = 0.01, 
                      color = &quot;white&quot;, from = -5, to = 95) +
  scale_fill_cyclical(breaks = c(&quot;1997 Summer&quot;, &quot;1997 Winter&quot;),
                      labels = c(`1997 Summer` = &quot;Summer&quot;, 
                                 `1997 Winter` = &quot;Winter&quot;),
                      values = c(&quot;tomato&quot;, &quot;dodgerblue&quot;),
                      name = &quot;Season&quot;, guide = &quot;legend&quot;) +
  theme_ridges() + 
  labs(x = &quot;Temperature (°F)&quot;, y = &quot;Year&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ridges-groups-1.png" width="100%" /></p>
<p>The <code>ggridges</code> packages is also helpful to create histograms for different groups using <code>stat = "binline"</code> in the <code>geom_density_ridges</code> command:</p>
<pre class="r"><code>ggplot(chic, aes(x = temp, y = factor(year), fill = year)) + 
  geom_density_ridges(stat = &quot;binline&quot;, bins = 25, scale = 0.9, 
                      draw_baseline = F, show.legend = F) + 
  labs(x = &quot;Temperature (°F)&quot;, y = &quot;Season&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ridges-histo-1.png" width="100%" /></p>
</div>
</div>
<div id="ribbons" class="section level2">
<h2>Working with Ribbons (AUC, CI, etc.)</h2>
<p>This is not a perfect dataset for demonstrating this, but using ribbon can be useful. In this example we will create a 30-day running average using the filter() function so that our ribbon is not too noisy.</p>
<pre class="r"><code>chic$o3run &lt;- as.numeric(stats::filter(chic$o3, rep(1/30, 30), sides = 2))

ggplot(chic, aes(x = date, y = o3run)) +
   geom_line(color = &quot;chocolate&quot;, lwd = 0.8) +
   labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/ribbon-default-1.png" width="100%" /></p>
<p>How does it look if we fill in the area below the curve using the <code>geom_ribbon()</code> function?</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = o3run)) +
   geom_ribbon(aes(ymin = 0, ymax = o3run), fill = &quot;orange&quot;, 
               color = &quot;orange&quot;, alpha = 0.4) +
   geom_line(color = &quot;chocolate&quot;, lwd = 0.8) +
   labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/geom-ribbon-AUC-1.png" width="100%" /></p>
<p>Nice to indicate the <a href="https://en.wikipedia.org/wiki/Area_under_the_curve_(pharmacokinetics)">area under the curve (AUC)</a> but this is not the conventional way to use <code>geom_ribbon()</code>. Instead, we draw a ribbon that gives us one standard deviation above and below our data:</p>
<pre class="r"><code>chic$mino3 &lt;- chic$o3run - sd(chic$o3run, na.rm = T)
chic$maxo3 &lt;- chic$o3run + sd(chic$o3run, na.rm = T)

ggplot(chic, aes(x = date, y = o3run)) +
   geom_ribbon(aes(ymin = mino3, ymax = maxo3), alpha = 0.5, 
               fill = &quot;darkseagreen3&quot;, color = &quot;transparent&quot;) +
   geom_line(color = &quot;aquamarine4&quot;, lwd = 0.7) +
   labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/geom-ribbon-range-1.png" width="100%" /></p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
<div id="smooths" class="section level2">
<h2>Working with Smoothings</h2>
<p>It is amazingly easy to add a smoothing to your data using <code>ggplot2</code>.</p>
<div id="default-adding-a-loess-or-gam-smoothing" class="section level3">
<h3>Default: Adding a LOESS or GAM Smoothing</h3>
<p>You can simply use <code>stat_smooth()</code> – not even a formula is required. This adds a LOESS (locally weighted scatterplot smoothing, <code>method = "loess"</code>) if you have fewer than 1000 points or a GAM (generalized additive model, <code>method = "gam"</code>) otherwise. Since we have more than 1000 points, the smoothing is based on a GAM.</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) + 
  geom_point(color = &quot;gray40&quot;, alpha = 0.5)+
  labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
  stat_smooth()</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/stat-smooth-1.png" width="100%" /></p>
</div>
<div id="specifying-the-formula-for-smoothing" class="section level3">
<h3>Specifying the Formula for Smoothing</h3>
<p><code>ggplot2</code> allows you to specify the model you want it to use. Lets say you want to increase the GAM dimension (add some additional wiggles to the smooth):</p>
<pre class="r"><code>ggplot(chic, aes(x = date, y = temp)) + 
   geom_point(color = &quot;gray40&quot;, alpha = 0.3) +
   labs(x = &quot;Year&quot;, y = &quot;Temperature (°F)&quot;) +
   stat_smooth(method = &quot;gam&quot;, formula = y ~ s(x, k = 1000), 
               se = F, size = 1.3, aes(col = &quot;1000&quot;)) +
   stat_smooth(method = &quot;gam&quot;, formula = y ~ s(x, k = 100), 
               se = F, size = 1, aes(col = &quot;100&quot;)) +
   stat_smooth(method = &quot;gam&quot;, formula = y ~ s(x, k = 10), 
               se = F, size = 0.8, aes(col = &quot;10&quot;)) +
   scale_color_manual(name = &quot;k&quot;, values = c(&quot;darkorange1&quot;, 
                                             &quot;firebrick&quot;, 
                                             &quot;dodgerblue3&quot;))</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/GAM-spec-1.png" width="100%" /></p>
</div>
<div id="adding-a-linear-fit" class="section level3">
<h3>Adding a Linear Fit</h3>
<p>Though the default is a LOESS or GAM smoothing, it is also easy to add a standard linear fit:</p>
<pre class="r"><code>ggplot(chic, aes(x = temp, y = death)) +
   geom_point(color = &quot;gray40&quot;, alpha = 0.5) +
   labs(x = &quot;Temperature (°F)&quot;, y = &quot;Deaths&quot;) +
   stat_smooth(method = &quot;lm&quot;, col = &quot;firebrick&quot;, se = F, size = 1.3)</code></pre>
<p><img src="/post/2019-08-05_ggplot2-tutorial_files/figure-html/GLM-1.png" width="100%" /></p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="interactive" class="section level2">
<h2>Working with Interactive Plots</h2>
<div id="shiny" class="section level3">
<h3>Shiny</h3>
<p>Shiny is a package from RStudio that makes it incredibly easy to build interactive web applications with R. For an introduction and live examples, visit the <a href="http://shiny.rstudio.com/">Shiny homepage</a>.</p>
<p>To look at the potential use, you can check out the Hello Shiny examples. This is the first one:</p>
<pre class="r"><code>library(shiny)
runExample(&quot;01_hello&quot;)</code></pre>
</div>
<div id="plot.ly" class="section level3">
<h3>Plot.ly</h3>
<p><a href="https://plot.ly/feed">Plot.ly</a> is a great tool for easily creating online, interactive graphics directly from your <code>ggplot2</code> plots. The process is surprisingly easy and can be done from within R.</p>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
<div id="remarks-tipps-tricks" class="section level2">
<h2>Remarks, Tipps &amp; Tricks</h2>
<div id="using-ggplot2-in-loops-and-functions" class="section level3">
<h3>Using <code>ggplot2</code> in Loops and Functions</h3>
<p>The grid-based graphics functions in lattice and ggplot2 create a graph object. When you use these functions interactively at the command line, the result is automatically printed, but in <code>source()</code> or inside your own functions you will need an explicit <code>print()</code> statement, i.e. <code>print(g)</code> in most of our examples. See also the <a href="https://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-do-lattice_002ftrellis-graphics-not-work_003f">Q&amp;A page of R</a>.</p>
</div>
<div id="additional-sources" class="section level3">
<h3>Additional Sources</h3>
<ul>
<li><a href="http://serialmentor.com/dataviz/">“Fundamentals of Data Visualization”</a>, an online book by Claus Wilke about data visualization in general but using <code>ggplot2</code>. (You can find the codes on <a href="https://github.com/clauswilke/dataviz">his GitHub profile</a>.)</li>
<li><a href="http://www.cookbook-r.com/Graphs/">“Cookbook for R”</a>, an online and printed book by Winston Chang with reciped to quickly produce the desired plot.</li>
</ul>
<p><a href="#toc">Jump back to Table of Content.</a></p>
</div>
</div>
